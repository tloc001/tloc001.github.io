import{_ as P,r as h,w as V,D as B,o as u,y as I,T as C,c as f,g as K,a as n,f as M,F as N,k as $,h as E,v as F,x as G,t as S,B as d,q as U,E as g}from"./index-D71806xI.js";const X={key:0,class:"modal-overlay"},j={class:"modal-content"},q={class:"inputs"},A=["onUpdate:modelValue","onInput","onKeydown"],L={class:"resend-note"},R=["disabled"],z={__name:"OTPView",props:{show:Boolean},emits:["close","verified","resend"],setup(v,{emit:w}){const y=v,p=w,a=h(["","","","","",""]),i=[],c=h(0);let r=null;const m=()=>{c.value=30,r&&clearInterval(r),r=setInterval(()=>{c.value>0?c.value--:clearInterval(r)},1e3)};m();const _=()=>{d.success("OTP đã được gửi lại"),p("resend"),m()};V(()=>y.show,t=>{t&&(a.value=["","","","","",""],g(()=>{var e;return(e=i[0])==null?void 0:e.focus()}))});const b=(t,e)=>{var o;const s=e.target.value;if(!/^\d$/.test(s)){a.value[t]="";return}a.value[t]=s,t<a.value.length-1&&((o=i[t+1])==null||o.focus())},k=(t,e)=>{var o;e.key==="Backspace"&&(a.value[t]===""?t>0&&(a.value[t-1]="",(o=i[t-1])==null||o.focus()):a.value[t]="",e.preventDefault())},T=t=>{const e=t.clipboardData.getData("text").trim();if(/^\d{6}$/.test(e)){for(let s=0;s<6;s++)a.value[s]=e[s];g(()=>{var s;return(s=i[5])==null?void 0:s.focus()})}t.preventDefault()},D=()=>{const t=a.value.join("");if(t.length<6){d.error("OTP phải gồm 6 chữ số");return}U.post("/Accounts/verify-otp",{otp:t}).then(e=>{d.success(e.data.message),p("verified")}).catch(e=>{var s,o;d.error(((o=(s=e.response)==null?void 0:s.data)==null?void 0:o.message)||"Xác minh thất bại")})},O=()=>{p("close")};return(t,e)=>(u(),B(C,{name:"fade"},{default:I(()=>[v.show?(u(),f("div",X,[n("div",j,[n("button",{class:"close-btn",onClick:O},"×"),n("form",{onSubmit:M(D,["prevent"]),class:"form"},[e[1]||(e[1]=n("div",{class:"title"},"Xác minh OTP",-1)),e[2]||(e[2]=n("p",{class:"message"},"Chúng tôi vừa gửi 1 mã OTP tới mail của bạn",-1)),n("div",q,[(u(!0),f(N,null,$(a.value,(s,o)=>E((u(),f("input",{key:o,"onUpdate:modelValue":l=>a.value[o]=l,maxlength:"1",type:"text",class:"otp-input",inputmode:"numeric",pattern:"\\d*",ref_for:!0,ref:l=>i[o]=l,onInput:l=>b(o,l),onKeydown:l=>k(o,l),onPaste:T},null,40,A)),[[F,a.value[o]]])),128))]),e[3]||(e[3]=n("button",{class:"action"},"Verify",-1)),n("p",L,[e[0]||(e[0]=G(" Không nhận được mail? ")),n("button",{type:"button",class:"resend-btn",onClick:_,disabled:c.value>0},S(c.value>0?`Gửi lại (${c.value}s)`:"Gửi lại"),9,R)])],32)])])):K("",!0)]),_:1}))}},J=P(z,[["__scopeId","data-v-696fa34c"]]);export{J as default};
